@rendermode InteractiveServer

@inject ITicketService ticketService

<SectionContent SectionName="page-title">Ticket Management</SectionContent>

<div class="filter-panel">
    Filter Here
</div>

<MudDataGrid @ref="dataGrid" 
    T="GetTicketResponse" 
    SortMode="@SortMode.None" 
    ServerData="ServerReload" 
>
    <Columns>
        <PropertyColumn Property="x => x.TicketIdView" Title="Ticket ID" />
        <PropertyColumn Property="x => x.Summary" />
        <PropertyColumn Property="x => x.Product" />
        <PropertyColumn Property="x => x.Category" />
        <PropertyColumn Property="x => x.Priority" />
        <PropertyColumn Property="x => x.Status" />
        <PropertyColumn Property="x => x.RaisedBy" Title="Raised By" />
        <PropertyColumn Property="x => x.ExpectedDate" Title="Expected Date" Format="yyyy-MM-dd"/>
        <PropertyColumn Property="x => x.CreatedDate" Title="Created Date" Format="yyyy-MM-dd" />
    </Columns>
    <PagerContent>
        <MudDataGridPager T="GetTicketResponse" />
    </PagerContent>
</MudDataGrid>

@code {
    MudDataGrid<GetTicketResponse> dataGrid;
    string searchString = null;

    private async Task<GridData<GetTicketResponse>> ServerReload(GridState<GetTicketResponse> state)
    {
        IEnumerable<GetTicketResponse> getTickets = ticketService.GetTickets(new Domain.DTO.Request.GetTicketRequest());

        await Task.Delay(300);

        var totalItems = getTickets.Count();

        var pagedData = getTickets.Skip(state.Page * state.PageSize).Take(state.PageSize).ToArray();
        return new GridData<GetTicketResponse>
        {
            TotalItems = totalItems,
            Items = pagedData
        };
    }
}
